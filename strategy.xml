<?xml version="1.0" encoding="UTF-8"?>
<GeminiPropChallengeAssistant>
  <Meta>
    <Version>6.0-VolScaled-WalkFwd</Version>
    <Objective>Pass Prop Challenge via volatility-scaled scalp & trend-breakout system with liquidity-sweep detection.</Objective>
    <Pairs>GBPUSD, XAUUSD</Pairs>
    <Constraints>
      <MaxDailyDrawdownPct>3.8</MaxDailyDrawdownPct>
      <MaxDailyLossStopTrades>3</MaxDailyLossStopTrades>
      <TradingSessions>London, NewYork</TradingSessions>
    </Constraints>
  </Meta>

  <EngineSettings>
    <Execution>
      <MaxSlippagePct>0.02</MaxSlippagePct>
      <UseLimitOnRetest>true</UseLimitOnRetest>
    </Execution>
    <DataWindowSec>900</DataWindowSec>
  </EngineSettings>

  <AI_Reasoning_Instructions>
    <LiquiditySweepDetection>
      <Rule>
        IF wick_length >= 1.5 * ATR(14)
        AND close reverses into candle body
        AND volume >= 2.0 * avg_volume(50)
        THEN -> HighProbabilitySweep (Weight 0.95)
      </Rule>
    </LiquiditySweepDetection>

    <FakeoutDetection>
      <BearishTrap>IF high > recent_high AND close &lt; recent_high AND upper_wick > 0.6 -> SellSignal</BearishTrap>
      <BullishTrap>IF low &lt; recent_low AND close > recent_low AND lower_wick > 0.6 -> BuySignal</BullishTrap>
    </FakeoutDetection>
  </AI_Reasoning_Instructions>

  <MarketRegimes>
    <Regime type="TRENDING">
      <Condition>ADX(14) >= 25 AND (EMA50 > EMA200 OR EMA50 &lt; EMA200)</Condition>
      <Strategy>BreakoutRetest, TrendScalp</Strategy>
    </Regime>
    <Regime type="RANGING">
      <Condition>ADX(14) &lt; 20 AND Price_Inside_Donchian(20)</Condition>
      <Strategy>FadeSupportResistance, RangeScalp</Strategy>
    </Regime>
  </MarketRegimes>

  <EntryRules>
    <SpreadLimit>
      <Normal>0.20% of ATR</Normal>
      <Gold_XAU>0.30% of ATR</Gold_XAU>
    </SpreadLimit>

    <PriceAction>
      <Pattern name="Pinbar">wick >= 0.66 body</Pattern>
      <Pattern name="Engulfing">body > prev_body and direction matches trend</Pattern>
    </PriceAction>

    <ScalpSetup timeframe="M5">
      <Buy>TrendUp (EMA50>200) + Bounce EMA50 + BullishPinbar/Sweep</Buy>
      <Sell>TrendDown (EMA50&lt;200) + Reject EMA50 + BearishPinbar/Sweep</Sell>
    </ScalpSetup>

    <BreakoutSetup timeframe="H1">
      <Buy>Close > SwingHigh + Retest + BullishPA + VolConfirm</Buy>
      <Sell>Close &lt; SwingLow + Retest + BearishPA + VolConfirm</Sell>
    </BreakoutSetup>
  </EntryRules>

  <VolatilityScaling>
    <BaseRiskPerTradePct>0.50</BaseRiskPerTradePct>
    <RefATR>
      <GBPUSD>0.0080</GBPUSD> <!-- 80 pips -->
      <XAUUSD>4.50</XAUUSD>   <!-- 450 ticks/$4.50 -->
    </RefATR>
    <Formula>risk_pct = BaseRisk * clamp(RefATR / current_ATR, 0.5, 2.0)</Formula>
  </VolatilityScaling>
</GeminiPropChallengeAssistant>